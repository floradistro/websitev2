
Running 82 tests using 1 worker

âœ… /api/vendor/inventory/adjust - Blocked unauthenticated request
âœ… /api/vendor/employees - Blocked unauthenticated request
  âœ˜   1 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:67:7 â€º Attack Scenarios - Auth Bypass Prevention â€º ATTACK 1: No authentication header (2.6s)
âœ… /api/vendor/employees - Header spoofing blocked
âœ… /api/vendor/analytics - Header spoofing blocked
âœ… /api/vendor/profit-stats - Header spoofing blocked
âœ… /api/supabase/vendor/payouts - Header spoofing blocked
  âœ“   2 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:85:7 â€º Attack Scenarios - Auth Bypass Prevention â€º ATTACK 2: Header spoofing with fake vendor ID (1.8s)
âœ… All malformed tokens rejected
  âœ“   3 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:106:7 â€º Attack Scenarios - Auth Bypass Prevention â€º ATTACK 3: Invalid/malformed JWT token (808ms)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
âš ï¸  Skipping test - no token available
  âœ“   4 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:129:7 â€º Attack Scenarios - Auth Bypass Prevention â€º ATTACK 4: Token + mismatched vendor header (134ms)
âœ… SQL injection attempts blocked
  âœ“   5 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:159:7 â€º Attack Scenarios - Auth Bypass Prevention â€º ATTACK 5: SQL injection in vendor ID (158ms)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
âš ï¸  Skipping test - no token available
  âœ“   6 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:180:7 â€º Attack Scenarios - Auth Bypass Prevention â€º ATTACK 6: Cross-vendor data access attempt (71ms)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
  âœ“   7 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:221:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-01: GET /api/vendor/inventory/grouped (442ms)
âœ… Inventory adjust - Auth enforced
  âœ“   8 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:236:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-02: POST /api/vendor/inventory/adjust (41ms)
âœ… Inventory transfer - Auth enforced
  âœ“   9 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:244:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-03: POST /api/vendor/inventory/transfer (439ms)
âœ… Inventory create - Auth enforced
  âœ“  10 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:252:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-04: POST /api/vendor/inventory/create (447ms)
âœ… Analytics - Auth enforced
  âœ“  11 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:261:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-05: GET /api/vendor/analytics (43ms)
âœ… Sales trend - Auth enforced
  âœ“  12 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:267:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-06: GET /api/vendor/analytics/sales-trend (462ms)
âœ… Analytics overview - Auth enforced
  âœ“  13 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:273:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-07: GET /api/vendor/analytics/overview (508ms)
âœ… Product analytics - Auth enforced
  âœ“  14 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:279:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-08: GET /api/vendor/analytics/products (484ms)
  âœ“  15 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:286:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-09: GET /api/vendor/employees - Vendor isolation (41ms)
âœ… Employee create - Auth enforced
  âœ“  16 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:308:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-10: POST /api/vendor/employees (46ms)
âœ… Vendor products - Auth enforced
  âœ“  17 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:317:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-11: GET /api/page-data/vendor-products (2.0s)
âœ… Product update - Auth enforced
  âœ“  18 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:323:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-12: PUT /api/supabase/products/[id] (1.2s)
âœ… Locations - 6 public, 0 vendor (without auth)
  âœ“  19 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:332:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-13: GET /api/supabase/locations - Public vs vendor (1.5s)
âœ… Profit stats - Auth enforced
  âœ“  20 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:344:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-14: GET /api/vendor/profit-stats (35ms)
âœ… Custom fields - Auth enforced
  âœ“  21 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:351:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-15: GET /api/vendor/custom-fields (463ms)
âœ… Pricing templates - Auth enforced
  âœ“  22 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:357:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-16: GET /api/vendor/pricing-templates (1.2s)
âœ… Categories - Auth enforced
  âœ“  23 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:363:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-17: POST /api/categories (470ms)
âœ… Vendor inventory page data - Auth enforced
  âœ“  24 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:372:7 â€º Phase 1 Routes - P0 Critical Security â€º P1-18: GET /api/page-data/vendor-inventory (490ms)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
âœ… Payouts - Auth enforced
  âœ“  25 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:391:7 â€º Phase 2 Routes - P1 High Security â€º P2-01: GET /api/supabase/vendor/payouts (38ms)
âœ… Vendor settings GET - Auth enforced
  âœ“  26 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:398:7 â€º Phase 2 Routes - P1 High Security â€º P2-02: GET /api/supabase/vendor/settings (867ms)
âœ… Vendor settings PUT - Auth enforced
  âœ“  27 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:404:7 â€º Phase 2 Routes - P1 High Security â€º P2-03: PUT /api/supabase/vendor/settings (40ms)
âœ… Cost-plus pricing GET - Auth enforced
  âœ“  28 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:412:7 â€º Phase 2 Routes - P1 High Security â€º P2-04: GET /api/vendor/cost-plus-pricing (873ms)
âœ… Cost-plus pricing POST - Auth enforced
  âœ“  29 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:418:7 â€º Phase 2 Routes - P1 High Security â€º P2-05: POST /api/vendor/cost-plus-pricing (40ms)
âœ… Schema presets - Auth enforced
  âœ“  30 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:426:7 â€º Phase 2 Routes - P1 High Security â€º P2-06: POST /api/schemas/presets (881ms)
âœ… Inventory update - Auth enforced
  âœ“  31 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:435:7 â€º Phase 2 Routes - P1 High Security â€º P2-07: PUT /api/supabase/inventory/[id] (1.2s)
âœ… Inventory delete - Auth enforced
  âœ“  32 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:443:7 â€º Phase 2 Routes - P1 High Security â€º P2-08: DELETE /api/supabase/inventory/[id] (43ms)
âœ… Stock movements GET - Auth enforced
  âœ“  33 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:449:7 â€º Phase 2 Routes - P1 High Security â€º P2-09: GET /api/supabase/stock-movements (922ms)
  âœ˜  34 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:455:7 â€º Phase 2 Routes - P1 High Security â€º P2-10: POST /api/supabase/stock-movements (285ms)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
âœ… Vendor analytics - Auth enforced
  âœ“  35 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:464:7 â€º Phase 2 Routes - P1 High Security â€º P2-11: GET /api/supabase/vendor/analytics (5.7s)
âœ… Vendor branding - Auth enforced
  âœ“  36 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:470:7 â€º Phase 2 Routes - P1 High Security â€º P2-12: GET /api/supabase/vendor/branding (842ms)
âœ… COA list - Auth enforced
  âœ“  37 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:476:7 â€º Phase 2 Routes - P1 High Security â€º P2-13: GET /api/supabase/vendor/coa (849ms)
  âœ˜  38 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:482:7 â€º Phase 2 Routes - P1 High Security â€º P2-14: GET /api/supabase/vendor/coa/[id] (1.1s)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
âœ… Vendor upload - Auth enforced
  âœ“  39 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:488:7 â€º Phase 2 Routes - P1 High Security â€º P2-15: POST /api/supabase/vendor/upload (973ms)
âœ… Vendor reviews - Auth enforced
  âœ“  40 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:496:7 â€º Phase 2 Routes - P1 High Security â€º P2-16: GET /api/supabase/vendor/reviews (1.0s)
âœ… Review respond - Auth enforced
  âœ“  41 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:502:7 â€º Phase 2 Routes - P1 High Security â€º P2-17: POST /api/supabase/vendor/reviews/[id]/respond (7.1s)
âœ… Dashboard data - Auth enforced
  âœ“  42 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:510:7 â€º Phase 2 Routes - P1 High Security â€º P2-18: GET /api/page-data/vendor-dashboard (2.3s)
âœ… Media GET - Auth enforced
  âœ“  43 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:517:7 â€º Phase 2 Routes - P1 High Security â€º P2-19: GET /api/vendor/media (679ms)
âœ… Media POST - Auth enforced
  âœ“  44 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:523:7 â€º Phase 2 Routes - P1 High Security â€º P2-20: POST /api/vendor/media (40ms)
âœ… Media add-background - Auth enforced
  âœ“  45 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:531:7 â€º Phase 2 Routes - P1 High Security â€º P2-21: POST /api/vendor/media/add-background (1.2s)
âœ… Media bulk-auto-match - Auth enforced
  âœ“  46 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:539:7 â€º Phase 2 Routes - P1 High Security â€º P2-22: POST /api/vendor/media/bulk-auto-match (892ms)
âœ… Media bulk-enhance - Auth enforced
  âœ“  47 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:547:7 â€º Phase 2 Routes - P1 High Security â€º P2-23: POST /api/vendor/media/bulk-enhance (917ms)
âœ… Media enhance - Auth enforced
  âœ“  48 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:555:7 â€º Phase 2 Routes - P1 High Security â€º P2-24: POST /api/vendor/media/enhance (2.2s)
âœ… Media enhance-stream - Auth enforced
  âœ“  49 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:563:7 â€º Phase 2 Routes - P1 High Security â€º P2-25: POST /api/vendor/media/enhance-stream (2.7s)
âœ… Media generate - Auth enforced
  âœ“  50 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:571:7 â€º Phase 2 Routes - P1 High Security â€º P2-26: POST /api/vendor/media/generate (2.1s)
âœ… Media migrate - Auth enforced
  âœ“  51 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:579:7 â€º Phase 2 Routes - P1 High Security â€º P2-27: POST /api/vendor/media/migrate (984ms)
âœ… Media reimagine - Auth enforced
  âœ“  52 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:587:7 â€º Phase 2 Routes - P1 High Security â€º P2-28: POST /api/vendor/media/reimagine (979ms)
âœ… Media remove-bg - Auth enforced
  âœ“  53 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:595:7 â€º Phase 2 Routes - P1 High Security â€º P2-29: POST /api/vendor/media/remove-bg (1.0s)
âœ… Media remove-bg-stream - Auth enforced
  âœ“  54 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:603:7 â€º Phase 2 Routes - P1 High Security â€º P2-30: POST /api/vendor/media/remove-bg-stream (1.1s)
  âœ˜  55 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:611:7 â€º Phase 2 Routes - P1 High Security â€º P2-31: POST /api/vendor/media/rename (1.1s)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
âœ… Media search-inspiration - Auth enforced
  âœ“  56 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:619:7 â€º Phase 2 Routes - P1 High Security â€º P2-32: POST /api/vendor/media/search-inspiration (5.7s)
âœ… Media upscale - Auth enforced
  âœ“  57 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:627:7 â€º Phase 2 Routes - P1 High Security â€º P2-33: POST /api/vendor/media/upscale (1.2s)
âœ… Media upscale-stream - Auth enforced
  âœ“  58 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:635:7 â€º Phase 2 Routes - P1 High Security â€º P2-34: POST /api/vendor/media/upscale-stream (1.1s)
âœ… AlpineIQ sync - Auth enforced
  âœ“  59 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:644:7 â€º Phase 2 Routes - P1 High Security â€º P2-35: POST /api/vendor/marketing/alpineiq/sync-loyalty (2.2s)
âœ… Marketing analytics - Auth enforced
  âœ“  60 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:652:7 â€º Phase 2 Routes - P1 High Security â€º P2-36: GET /api/vendor/marketing/analytics (1.1s)
âœ… Marketing automation GET - Auth enforced
  âœ“  61 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:658:7 â€º Phase 2 Routes - P1 High Security â€º P2-37: GET /api/vendor/marketing/automation (1.1s)
âœ… Marketing automation POST - Auth enforced
  âœ“  62 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:664:7 â€º Phase 2 Routes - P1 High Security â€º P2-38: POST /api/vendor/marketing/automation (53ms)
  âœ˜  63 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:672:7 â€º Phase 2 Routes - P1 High Security â€º P2-39: GET /api/vendor/marketing/campaigns (1.2s)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
  âœ˜  64 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:678:7 â€º Phase 2 Routes - P1 High Security â€º P2-40: POST /api/vendor/marketing/email/generate (1.2s)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
  âœ˜  65 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:686:7 â€º Phase 2 Routes - P1 High Security â€º P2-41: POST /api/vendor/marketing/segments/estimate (1.3s)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
  âœ˜  66 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:694:7 â€º Phase 2 Routes - P1 High Security â€º P2-42: GET /api/vendor/marketing/segments (1.1s)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
  âœ˜  67 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:700:7 â€º Phase 2 Routes - P1 High Security â€º P2-43: POST /api/vendor/marketing/segments (69ms)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
  âœ˜  68 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:708:7 â€º Phase 2 Routes - P1 High Security â€º P2-44: POST /api/vendor/marketing/sms/campaigns (6.2s)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
  âœ˜  69 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:716:7 â€º Phase 2 Routes - P1 High Security â€º P2-45: POST /api/vendor/marketing/sms/generate (1.0s)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
  âœ˜  70 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:724:7 â€º Phase 2 Routes - P1 High Security â€º P2-46: GET /api/vendor/marketing/stats (1.0s)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
  âœ˜  71 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:731:7 â€º Phase 2 Routes - P1 High Security â€º P2-47: POST /api/business-templates/import (1.0s)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
  âœ˜  72 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:739:7 â€º Phase 2 Routes - P1 High Security â€º P2-48: GET /api/vendor/reviews (1.0s)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
âš ï¸  Skipping - no token
  âœ“  73 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:757:7 â€º Real-World Security Scenarios â€º SCENARIO 1: Complete vendor workflow (authenticated) (4ms)
  âœ˜  74 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:790:7 â€º Real-World Security Scenarios â€º SCENARIO 2: Attacker tries multiple bypass techniques (2.9s)
âš ï¸  No auth-enabled user found for vendor: cd2e1122-d511-4edb-be5d-98ef274b4baf
âš ï¸  Skipping - no token
  âœ“  75 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:813:7 â€º Real-World Security Scenarios â€º SCENARIO 3: Vendor isolation across multiple endpoints (4ms)
  âœ˜  76 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:851:7 â€º Edge Cases and Error Handling â€º EDGE 1: Empty Authorization header (50ms)
  âœ˜  77 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:859:7 â€º Edge Cases and Error Handling â€º EDGE 2: Authorization header without Bearer (69ms)
  âœ˜  78 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:867:7 â€º Edge Cases and Error Handling â€º EDGE 3: Multiple Authorization headers (57ms)
  âœ˜  79 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:877:7 â€º Edge Cases and Error Handling â€º EDGE 4: Case sensitivity in headers (66ms)
  âœ˜  80 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:894:7 â€º Edge Cases and Error Handling â€º EDGE 5: Very long token (55ms)
  âœ˜  81 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:903:7 â€º Edge Cases and Error Handling â€º EDGE 6: Unicode and special characters in headers (7ms)

======================================================================
COMPREHENSIVE SECURITY VALIDATION - SUMMARY
======================================================================
âœ… Attack Scenarios: 6 scenarios tested
âœ… Phase 1 Routes: 18 P0 routes tested
âœ… Phase 2 Routes: 48 P1 routes tested (41 unique + variations)
âœ… Real-World Scenarios: 3 workflows tested
âœ… Edge Cases: 6 edge cases tested
======================================================================
Total Tests: 80+ comprehensive security tests
Coverage: 59 unique routes (Phase 1: 18 + Phase 2: 41)
======================================================================
ðŸ”’ ALL SECURITY MEASURES VALIDATED âœ…
======================================================================

  âœ“  82 [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:922:7 â€º Test Suite Summary â€º Final validation - All security measures active (2ms)


  1) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:67:7 â€º Attack Scenarios - Auth Bypass Prevention â€º ATTACK 1: No authentication header 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m405[39m

      78 |       });
      79 |
    > 80 |       expect(response.status()).toBe(401);
         |                                 ^
      81 |       console.log(`âœ… ${endpoint} - Blocked unauthenticated request`);
      82 |     }
      83 |   });
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:80:33

  2) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:455:7 â€º Phase 2 Routes - P1 High Security â€º P2-10: POST /api/supabase/stock-movements 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      457 |       data: { inventory_id: 'test', product_id: 'test', movement_type: 'sale', quantity: 1 }
      458 |     });
    > 459 |     expect(noAuth.status()).toBe(401);
          |                             ^
      460 |     console.log('âœ… Stock movements POST - Auth enforced');
      461 |   });
      462 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:459:29

  3) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:482:7 â€º Phase 2 Routes - P1 High Security â€º P2-14: GET /api/supabase/vendor/coa/[id] 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m405[39m

      482 |   test('P2-14: GET /api/supabase/vendor/coa/[id]', async ({ request }) => {
      483 |     const noAuth = await request.get(`${BASE_URL}/api/supabase/vendor/coa/test-id`);
    > 484 |     expect(noAuth.status()).toBe(401);
          |                             ^
      485 |     console.log('âœ… COA detail - Auth enforced');
      486 |   });
      487 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:484:29

  4) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:611:7 â€º Phase 2 Routes - P1 High Security â€º P2-31: POST /api/vendor/media/rename 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m405[39m

      613 |       data: { mediaId: 'test', name: 'new' }
      614 |     });
    > 615 |     expect(noAuth.status()).toBe(401);
          |                             ^
      616 |     console.log('âœ… Media rename - Auth enforced');
      617 |   });
      618 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:615:29

  5) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:672:7 â€º Phase 2 Routes - P1 High Security â€º P2-39: GET /api/vendor/marketing/campaigns 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      672 |   test('P2-39: GET /api/vendor/marketing/campaigns', async ({ request }) => {
      673 |     const noAuth = await request.get(`${BASE_URL}/api/vendor/marketing/campaigns`);
    > 674 |     expect(noAuth.status()).toBe(401);
          |                             ^
      675 |     console.log('âœ… Marketing campaigns - Auth enforced');
      676 |   });
      677 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:674:29

  6) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:678:7 â€º Phase 2 Routes - P1 High Security â€º P2-40: POST /api/vendor/marketing/email/generate 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      680 |       data: { prompt: 'test' }
      681 |     });
    > 682 |     expect(noAuth.status()).toBe(401);
          |                             ^
      683 |     console.log('âœ… Email generate - Auth enforced');
      684 |   });
      685 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:682:29

  7) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:686:7 â€º Phase 2 Routes - P1 High Security â€º P2-41: POST /api/vendor/marketing/segments/estimate 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      688 |       data: { filters: [] }
      689 |     });
    > 690 |     expect(noAuth.status()).toBe(401);
          |                             ^
      691 |     console.log('âœ… Segment estimate - Auth enforced');
      692 |   });
      693 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:690:29

  8) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:694:7 â€º Phase 2 Routes - P1 High Security â€º P2-42: GET /api/vendor/marketing/segments 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      694 |   test('P2-42: GET /api/vendor/marketing/segments', async ({ request }) => {
      695 |     const noAuth = await request.get(`${BASE_URL}/api/vendor/marketing/segments`);
    > 696 |     expect(noAuth.status()).toBe(401);
          |                             ^
      697 |     console.log('âœ… Segments GET - Auth enforced');
      698 |   });
      699 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:696:29

  9) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:700:7 â€º Phase 2 Routes - P1 High Security â€º P2-43: POST /api/vendor/marketing/segments 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      702 |       data: { name: 'test' }
      703 |     });
    > 704 |     expect(noAuth.status()).toBe(401);
          |                             ^
      705 |     console.log('âœ… Segments POST - Auth enforced');
      706 |   });
      707 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:704:29

  10) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:708:7 â€º Phase 2 Routes - P1 High Security â€º P2-44: POST /api/vendor/marketing/sms/campaigns 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      710 |       data: { message: 'test' }
      711 |     });
    > 712 |     expect(noAuth.status()).toBe(401);
          |                             ^
      713 |     console.log('âœ… SMS campaigns POST - Auth enforced');
      714 |   });
      715 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:712:29

  11) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:716:7 â€º Phase 2 Routes - P1 High Security â€º P2-45: POST /api/vendor/marketing/sms/generate 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      718 |       data: { prompt: 'test' }
      719 |     });
    > 720 |     expect(noAuth.status()).toBe(401);
          |                             ^
      721 |     console.log('âœ… SMS generate - Auth enforced');
      722 |   });
      723 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:720:29

  12) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:724:7 â€º Phase 2 Routes - P1 High Security â€º P2-46: GET /api/vendor/marketing/stats 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      724 |   test('P2-46: GET /api/vendor/marketing/stats', async ({ request }) => {
      725 |     const noAuth = await request.get(`${BASE_URL}/api/vendor/marketing/stats`);
    > 726 |     expect(noAuth.status()).toBe(401);
          |                             ^
      727 |     console.log('âœ… Marketing stats - Auth enforced');
      728 |   });
      729 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:726:29

  13) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:731:7 â€º Phase 2 Routes - P1 High Security â€º P2-47: POST /api/business-templates/import 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      733 |       data: { template_id: 'test' }
      734 |     });
    > 735 |     expect(noAuth.status()).toBe(401);
          |                             ^
      736 |     console.log('âœ… Business templates - Auth enforced');
      737 |   });
      738 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:735:29

  14) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:739:7 â€º Phase 2 Routes - P1 High Security â€º P2-48: GET /api/vendor/reviews 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      739 |   test('P2-48: GET /api/vendor/reviews', async ({ request }) => {
      740 |     const noAuth = await request.get(`${BASE_URL}/api/vendor/reviews`);
    > 741 |     expect(noAuth.status()).toBe(401);
          |                             ^
      742 |     console.log('âœ… Vendor reviews - Auth enforced');
      743 |   });
      744 | });
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:741:29

  15) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:790:7 â€º Real-World Security Scenarios â€º SCENARIO 2: Attacker tries multiple bypass techniques 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      805 |       });
      806 |
    > 807 |       expect(response.status()).toBe(attack.expectedStatus);
          |                                 ^
      808 |     }
      809 |
      810 |     console.log('âœ… All attack vectors blocked');
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:807:33

  16) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:851:7 â€º Edge Cases and Error Handling â€º EDGE 1: Empty Authorization header 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      853 |       headers: { 'Authorization': '' }
      854 |     });
    > 855 |     expect(response.status()).toBe(401);
          |                               ^
      856 |     console.log('âœ… Empty auth header rejected');
      857 |   });
      858 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:855:31

  17) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:859:7 â€º Edge Cases and Error Handling â€º EDGE 2: Authorization header without Bearer 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      861 |       headers: { 'Authorization': 'some-token' }
      862 |     });
    > 863 |     expect(response.status()).toBe(401);
          |                               ^
      864 |     console.log('âœ… Non-Bearer auth rejected');
      865 |   });
      866 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:863:31

  18) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:867:7 â€º Edge Cases and Error Handling â€º EDGE 3: Multiple Authorization headers 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      871 |       }
      872 |     });
    > 873 |     expect(response.status()).toBe(401);
          |                               ^
      874 |     console.log('âœ… Multiple auth headers rejected');
      875 |   });
      876 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:873:31

  19) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:877:7 â€º Edge Cases and Error Handling â€º EDGE 4: Case sensitivity in headers 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      886 |         headers
      887 |       });
    > 888 |       expect(response.status()).toBe(401);
          |                                 ^
      889 |     }
      890 |
      891 |     console.log('âœ… Header case variations handled');
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:888:33

  20) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:894:7 â€º Edge Cases and Error Handling â€º EDGE 5: Very long token 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m401[39m
    Received: [31m500[39m

      897 |       headers: { 'Authorization': `Bearer ${longToken}` }
      898 |     });
    > 899 |     expect(response.status()).toBe(401);
          |                               ^
      900 |     console.log('âœ… Extremely long token rejected');
      901 |   });
      902 |
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:899:31

  21) [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:903:7 â€º Edge Cases and Error Handling â€º EDGE 6: Unicode and special characters in headers 

    TypeError: apiRequestContext.get: Invalid character in header content ["x-vendor-id"]

      905 |
      906 |     for (const char of specialChars) {
    > 907 |       const response = await request.get(`${BASE_URL}/api/vendor/employees`, {
          |                                      ^
      908 |         headers: { 'x-vendor-id': char }
      909 |       });
      910 |       expect(response.status()).toBe(401);
        at /Users/whale/Desktop/whaletools/tests/security/comprehensive-security-validation.spec.ts:907:38

  21 failed
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:67:7 â€º Attack Scenarios - Auth Bypass Prevention â€º ATTACK 1: No authentication header 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:455:7 â€º Phase 2 Routes - P1 High Security â€º P2-10: POST /api/supabase/stock-movements 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:482:7 â€º Phase 2 Routes - P1 High Security â€º P2-14: GET /api/supabase/vendor/coa/[id] 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:611:7 â€º Phase 2 Routes - P1 High Security â€º P2-31: POST /api/vendor/media/rename 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:672:7 â€º Phase 2 Routes - P1 High Security â€º P2-39: GET /api/vendor/marketing/campaigns 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:678:7 â€º Phase 2 Routes - P1 High Security â€º P2-40: POST /api/vendor/marketing/email/generate 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:686:7 â€º Phase 2 Routes - P1 High Security â€º P2-41: POST /api/vendor/marketing/segments/estimate 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:694:7 â€º Phase 2 Routes - P1 High Security â€º P2-42: GET /api/vendor/marketing/segments 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:700:7 â€º Phase 2 Routes - P1 High Security â€º P2-43: POST /api/vendor/marketing/segments 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:708:7 â€º Phase 2 Routes - P1 High Security â€º P2-44: POST /api/vendor/marketing/sms/campaigns 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:716:7 â€º Phase 2 Routes - P1 High Security â€º P2-45: POST /api/vendor/marketing/sms/generate 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:724:7 â€º Phase 2 Routes - P1 High Security â€º P2-46: GET /api/vendor/marketing/stats 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:731:7 â€º Phase 2 Routes - P1 High Security â€º P2-47: POST /api/business-templates/import 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:739:7 â€º Phase 2 Routes - P1 High Security â€º P2-48: GET /api/vendor/reviews 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:790:7 â€º Real-World Security Scenarios â€º SCENARIO 2: Attacker tries multiple bypass techniques 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:851:7 â€º Edge Cases and Error Handling â€º EDGE 1: Empty Authorization header 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:859:7 â€º Edge Cases and Error Handling â€º EDGE 2: Authorization header without Bearer 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:867:7 â€º Edge Cases and Error Handling â€º EDGE 3: Multiple Authorization headers 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:877:7 â€º Edge Cases and Error Handling â€º EDGE 4: Case sensitivity in headers 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:894:7 â€º Edge Cases and Error Handling â€º EDGE 5: Very long token 
    [chromium] â€º tests/security/comprehensive-security-validation.spec.ts:903:7 â€º Edge Cases and Error Handling â€º EDGE 6: Unicode and special characters in headers 
  61 passed (1.6m)
